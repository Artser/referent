# План реализации функций кнопок AI

## Цель
Добавить функциональность для кнопок "О чем статья?", "Тезисы" и "Пост для Telegram", чтобы они использовали AI для генерации соответствующих ответов на основе спарсенного контента статьи.

## Текущее состояние
- ✅ Парсинг статей реализован (`/api/parse`)
- ✅ Перевод через OpenRouter AI реализован (`/api/translate`)
- ✅ Кнопки отображаются в интерфейсе
- ⚠️ Кнопки пока только показывают JSON с парсингом, без AI-обработки

## Порядок действий

### 1. Создание API-роута для "О чем статья?" (`/api/summary`)

**Файл:** `app/api/summary/route.ts`

**Шаги:**
1. Создать POST-эндпоинт, принимающий `{ url: string }`
2. Сначала вызвать парсинг статьи через внутренний вызов логики `/api/parse` или напрямую использовать cheerio
3. Извлечь контент статьи (title и content)
4. Отправить запрос в OpenRouter API с моделью `deepseek/deepseek-chat`
5. Промпт для системы: "Ты аналитик статей. Напиши краткое резюме статьи (2-3 абзаца). Опиши основную тему, ключевые моменты и выводы."
6. Вернуть результат в формате `{ summary: string }`

**Промпт пример:**
```
System: Ты аналитик статей. Напиши краткое резюме статьи на русском языке (2-3 абзаца). Опиши основную тему, ключевые моменты и выводы.

User: Заголовок: {title}

Контент: {content}
```

### 2. Создание API-роута для "Тезисы" (`/api/theses`)

**Файл:** `app/api/theses/route.ts`

**Шаги:**
1. Создать POST-эндпоинт, принимающий `{ url: string }`
2. Сначала вызвать парсинг статьи
3. Извлечь контент статьи
4. Отправить запрос в OpenRouter API с моделью `deepseek/deepseek-chat`
5. Промпт для системы: "Ты аналитик. Выдели основные тезисы статьи в виде пронумерованного списка. Каждый тезис должен быть кратким (1-2 предложения)."
6. Вернуть результат в формате `{ theses: string }`

**Промпт пример:**
```
System: Ты аналитик статей. Выдели основные тезисы статьи на русском языке в виде пронумерованного списка. Каждый тезис должен быть кратким (1-2 предложения) и отражать ключевую мысль.

User: Заголовок: {title}

Контент: {content}
```

### 3. Создание API-роута для "Пост для Telegram" (`/api/telegram`)

**Файл:** `app/api/telegram/route.ts`

**Шаги:**
1. Создать POST-эндпоинт, принимающий `{ url: string }`
2. Сначала вызвать парсинг статьи
3. Извлечь контент статьи (title, content, date если есть)
4. Отправить запрос в OpenRouter API с моделью `deepseek/deepseek-chat`
5. Промпт для системы: "Ты копирайтер для Telegram-канала. Создай пост на основе статьи. Пост должен быть интересным, с эмодзи, хэштегами и призывом к действию. Длина: 2-3 абзаца."
6. Вернуть результат в формате `{ telegramPost: string }`

**Промпт пример:**
```
System: Ты копирайтер для Telegram-канала. Создай пост на русском языке на основе статьи. Пост должен быть интересным, с эмодзи, хэштегами и призывом к действию. Длина: 2-3 абзаца. Используй разметку Markdown.

User: Заголовок: {title}
Дата: {date}

Контент: {content}
```

### 4. Обновление клиентской части (`app/page.tsx`)

**Шаги:**
1. Обновить функцию `handleAction` для обработки новых действий:
   - Для `'summary'`: вызвать `/api/summary`
   - Для `'theses'`: вызвать `/api/theses`
   - Для `'telegram'`: вызвать `/api/telegram`
2. После получения ответа от API, установить результат в `setResult`
3. Обновить отображение результата:
   - Для summary, theses, telegram - показывать как обычный текст (не JSON)
   - Обновить заголовок блока результата в зависимости от действия
4. Добавить обработку ошибок для каждого типа запроса

### 5. Общие улучшения и оптимизация

**Шаги:**
1. Создать общую утилиту для работы с OpenRouter API (опционально, для избежания дублирования кода)
2. Добавить валидацию ответов от AI
3. Добавить ограничение на длину контента для предотвращения превышения лимитов API
4. Добавить индикацию прогресса (если нужно показать этапы: "Парсинг...", "Генерация...")

### 6. Тестирование

**Шаги:**
1. Протестировать каждую кнопку с реальной англоязычной статьей
2. Проверить обработку ошибок (недоступный URL, ошибки API, пустой контент)
3. Проверить форматирование результатов
4. Убедиться, что результаты отображаются корректно

## Зависимости
- OpenRouter API ключ должен быть настроен в `.env.local` как `OPENROUTER_API_KEY`
- Модель: `deepseek/deepseek-chat` (или другая по необходимости)

## Структура API-роутов (одинаковая для всех трех)

```typescript
export async function POST(req: NextRequest) {
  try {
    // 1. Получить URL из запроса
    // 2. Спарсить статью
    // 3. Подготовить промпт для AI
    // 4. Отправить запрос в OpenRouter
    // 5. Вернуть результат
  } catch (error) {
    // Обработка ошибок
  }
}
```

## Примечания
- Все три функции следуют одинаковому паттерну: парсинг → AI-обработка → результат
- Можно вынести логику парсинга в общую утилиту для избежания дублирования
- Промпты должны быть четкими и указывать на желаемый формат вывода
- Результаты должны быть на русском языке (как указано в PROJECT.md)

